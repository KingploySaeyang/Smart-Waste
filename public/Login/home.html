<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Smart Waste - Sign In</title>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

  <style>
    /* --- Reset & Fonts --- */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Prompt", "Segoe UI", sans-serif; }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow-x: hidden; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≠ */
      
      /* --- Eco-Tech Theme Gradient --- */
      background: linear-gradient(-45deg, #064e3b, #059669, #0d9488, #0ea5e9);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* --- Gimmick: Floating Particles --- */
    .particles {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        overflow: hidden;
        z-index: 0;
        pointer-events: none;
    }

    .particles span {
        position: absolute;
        display: block;
        list-style: none;
        width: 20px; height: 20px;
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
        animation: floatUp 25s linear infinite;
        bottom: -150px;
        border-radius: 50%;
    }
    /* (Animation settings remain the same) */
    .particles span:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; animation-duration: 20s; }
    .particles span:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
    .particles span:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
    .particles span:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
    .particles span:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
    .particles span:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
    .particles span:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
    .particles span:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }

    @keyframes floatUp {
        0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
        100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; }
    }

    /* --- Container --- */
    .container {
      position: relative;
      width: 100%;
      max-width: 1100px;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 1fr 1fr; /* Desktop: 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
      align-items: center;
      gap: 40px;
      z-index: 2;
    }

    /* --- Left Panel --- */
    .left-panel {
      color: #fff;
      padding-right: 20px;
      animation: fadeIn 0.8s ease-out;
      text-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .left-panel h3 {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: 2px;
      margin-bottom: 10px;
      text-transform: uppercase;
      color: #d1fae5;
    }
    .left-panel h1 {
      font-size: 48px;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 20px;
      text-transform: uppercase;
    }
    .left-panel p {
      font-size: 16px;
      line-height: 1.6;
      opacity: 0.9;
      max-width: 480px;
    }

    /* --- Right Panel (Card) --- */
    .right-panel {
      display: flex;
      justify-content: center;
    }

    .login-card {
      background: rgba(255, 255, 255, 0.95);
      width: 100%;
      max-width: 420px;
      border-radius: 30px;
      padding: 50px 40px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(5px);
      animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .login-header h2 {
      font-size: 32px;
      color: #047857; 
      font-weight: 700;
      margin-bottom: 8px;
    }
    .login-header p { color: #64748b; font-size: 14px; }

    /* --- Form Elements --- */
    .form-group { margin-bottom: 20px; position: relative; }

    /* ‡πÉ‡∏ä‡πâ font-size 16px ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô iOS Zoom */
    input[type="text"], input[type="password"] {
      width: 100%; padding: 14px 16px; border: 1px solid #e2e8f0; border-radius: 12px;
      font-size: 16px; color: #334155; transition: all 0.3s; background: #f8fafc;
    }
    input::placeholder { color: #cbd5e1; }
    input:focus {
      outline: none; border-color: #10b981; background: #fff;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
    }

    .show-pass {
      position: absolute; right: 16px; top: 50%; transform: translateY(-50%);
      font-size: 12px; font-weight: 700; color: #059669; cursor: pointer; user-select: none;
    }
    .show-pass:hover { color: #047857; }

    .form-options {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 30px; font-size: 13px; color: #64748b;
    }
    .checkbox-container { display: flex; align-items: center; gap: 6px; cursor: pointer; }
    .checkbox-container input { accent-color: #059669; width: 16px; height: 16px; }
    .forgot-link { color: #64748b; text-decoration: none; font-weight: 500; }
    .forgot-link:hover { color: #059669; }

    .btn-submit {
      width: 100%; padding: 14px;
      background: #059669; 
      color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
      margin-bottom: 24px;
    }
    .btn-submit:hover { 
      background: #047857;
      transform: translateY(-2px); 
      box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3); 
    }
    .btn-submit:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; }

    .form-footer { text-align: center; font-size: 14px; color: #94a3b8; }
    .link-signup { color: #059669; font-weight: 600; text-decoration: none; cursor: pointer; }
    .link-signup:hover { text-decoration: underline; color: #047857; }

    #status { margin-top: 15px; text-align: center; font-size: 13px; min-height: 20px; }
    .err { color: #ef4444; } .ok { color: #059669; }

    /* --- Animations --- */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    /* =========================================
       üì± Mobile Responsive Styles
       ========================================= */
    @media (max-width: 850px) {
      body {
        align-items: flex-start; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ñ‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏¢‡∏≤‡∏ß */
        padding: 40px 20px;
        overflow-y: auto; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏î‡πâ */
      }

      .container {
        grid-template-columns: 1fr; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        gap: 30px;
        max-width: 500px;
      }

      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô Branding ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
      .left-panel {
        display: block; /* ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
        text-align: center; /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        padding-right: 0;
        margin-bottom: 10px;
      }

      .left-panel h3 { font-size: 18px; margin-bottom: 5px; }
      .left-panel h1 { font-size: 32px; margin-bottom: 15px; }
      .left-panel p { 
        font-size: 14px; 
        margin: 0 auto; 
        opacity: 0.95;
      }

      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î Login */
      .login-card {
        padding: 30px 25px; /* ‡∏•‡∏î Padding ‡∏•‡∏á */
      }

      .login-header h2 { font-size: 26px; }
    }
  </style>
</head>
<body>

  <div class="particles">
    <span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span>
  </div>

  <div class="container">
    <div class="left-panel">
      <h3>Welcome To</h3>
      <h1>Smart Waste<br>Platform</h1>
      <p>
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏∞‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏¢‡∏∞ (Tracking) 
        ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö Real-time ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
      </p>
    </div>

    <div class="right-panel">
      <div class="login-card">
        <div class="login-header">
          <h2>Sign in</h2>
          <p>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        </div>

        <form id="loginForm">
          <div class="form-group">
            <input id="username" name="username" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (User Name)" autocomplete="username" required />
          </div>

          <div class="form-group">
            <input id="password" name="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)" autocomplete="current-password" required />
            <span class="show-pass" id="togglePass">SHOW</span>
          </div>

          <div class="form-options">
            <label class="checkbox-container">
              <input type="checkbox" id="rememberMe">
              ‡∏à‡∏î‡∏à‡∏≥‡∏â‡∏±‡∏ô‡πÑ‡∏ß‡πâ
            </label>
            <a href="#" class="forgot-link">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
          </div>

          <button type="submit" class="btn-submit">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>

          <div class="form-footer">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? <span class="link-signup" id="registerBtn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
          </div>
        </form>

        <div id="status"></div>
      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const loginForm = $("loginForm");
    const registerBtn = $("registerBtn");
    const statusEl = $("status");
    const togglePassBtn = $("togglePass");
    const passwordInput = $("password");

    togglePassBtn.addEventListener("click", () => {
      const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
      togglePassBtn.textContent = type === "password" ? "SHOW" : "HIDE";
    });

    function setStatus(text, type){
      statusEl.textContent = text || "";
      statusEl.className = type || "";
      if(text) setTimeout(() => {
          if(statusEl.className !== 'ok') statusEl.textContent = "";
          statusEl.className = "";
      }, 4000);
    }

    // ---- Firebase Config ----
    var firebaseConfig = {
      apiKey: "AIzaSyCyTSsRmX642krpJYOI-TfFpIhnxJBbzxk",
      authDomain: "smart-waste2568.firebaseapp.com",
      projectId: "smart-waste2568",
      storageBucket: "smart-waste2568.firebasestorage.app",
      messagingSenderId: "122699752010",
      appId: "1:122699752010:web:c22ab9b28ac15beaedbcb3",
      measurementId: "G-H82914YP66"
    };
    if (!firebase.apps.length) {
       firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const usersCol = db.collection("users");

    async function hashPassword(pw){
      const encoder = new TextEncoder();
      const data = encoder.encode(pw);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2,"0")).join("");
    }

    const statusRoutes = {
      0: "../Admin/addBin.html",
      1: "../Driver/Driver.html",
      2: "../User/home.html"
    };

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = $("username").value.trim();
      const password = $("password").value.trim();

      if(!username || !password){
        setStatus("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "err");
        return;
      }

      const btn = loginForm.querySelector('.btn-submit');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<i class="ri-loader-4-line ri-spin"></i> Checking...';
      btn.disabled = true;

      try{
        const docSnap = await usersCol.doc(username).get();
        if(!docSnap.exists){
          setStatus("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ", "err");
          throw new Error("User not found");
        }
        
        const hash = await hashPassword(password);
        const data = docSnap.data() || {};
        
        if(data.passwordHash !== hash){
          setStatus("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "err");
          throw new Error("Wrong password");
        }

        const statusValue = typeof data.status === "number" ? data.status : 2;
        localStorage.setItem("sw_user", JSON.stringify({
          username,
          status: statusValue,
          fullName: data.fullName || "",
          email: data.email || "",
          loginAt: Date.now()
        }));

        const target = statusRoutes[statusValue] || statusRoutes[2];
        setStatus("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á...", "ok");
        setTimeout(() => window.location.href = target, 1000);

      }catch(err){
        console.error(err);
        btn.innerHTML = originalText;
        btn.disabled = false;
        if(statusEl.textContent === "") setStatus("Error: " + err.message, "err");
      }
    });

    registerBtn.addEventListener("click", () => {
      document.querySelector('.login-card').style.transform = 'translateY(-20px)';
      document.querySelector('.login-card').style.opacity = '0';
      setTimeout(() => {
          window.location.href = "register.html";
      }, 300);
    });
  </script>
</body>
</html>


