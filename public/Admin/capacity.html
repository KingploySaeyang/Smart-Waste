<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Smart Waste - ความจุถังขยะ</title>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="../Login/auth.js"></script>
  <script src="admin-lang.js"></script>
  <script src="admin-user.js" defer></script>
  <script src="admin-nav.js" defer></script>
  <script>
    const currentUser = window.SWAuth.requireAuth([0]);
  </script>

  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",system-ui,Roboto,Arial,sans-serif}
    body{display:flex;min-height:100vh;background:#f5f6fa;flex-direction:row;}

    /* ---------- Sidebar ---------- */
    .sidebar {
      width: 250px;
      background: #2f3640;
      color: #f5f6fa;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding-top: 20px;
      transition: .3s;
    }
    .sidebar h2{text-align:center;color:#00a8ff;margin-bottom:25px}
    .menu {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 4px;
    }

    .sidebar .sw-logout-slot {
      margin-top: 0 !important;
      margin-left: 18px;
      margin-right: 18px;
      margin-bottom: 24px;
      padding: 0;
    }
    .menu a{
      display:block;color:#f5f6fa;padding:14px 20px;
      text-decoration:none;border-left:4px solid transparent;
      transition:.3s
    }
    .menu a:hover,.menu a.active{background:#353b48;border-left:4px solid #00a8ff}

    .sidebar .sw-logout-slot .sw-logout-btn{
      display:block;
      width:100%;
      text-align:left;
      padding:14px 20px;
      margin-top:6px;
      border:none;
      border-radius:10px;
      background:#dc2626;
      color:#fff;
      font-size:15px;
      font-weight:600;
      box-shadow:none !important;
      transform:none !important;
    }
    .sidebar .sw-logout-slot .sw-logout-btn:hover,
    .sidebar .sw-logout-slot .sw-logout-btn:focus{
      background:#b91c1c;
      border-left:0;
    }

    /* ปุ่มเปิดเมนูสำหรับมือถือ */
    .toggle-btn{
      display:none;position:fixed;top:14px;left:14px;
      background:#00a8ff;color:#fff;border:none;
      padding:8px 12px;border-radius:6px;
      cursor:pointer;z-index:1000;
    }

    /* Main */
    main{flex:1;padding:30px;overflow-y:auto}
    h1{color:#2f3640;margin-bottom:16px}
    .content{
      background:#fff;padding:24px;border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.08)
    }

    /* Card + table */
    .card{
      border:1px solid #e5e7eb;border-radius:12px;
      padding:14px;margin:12px 0
    }
    label{display:block;margin-bottom:6px}
    select,input{
      padding:9px 12px;border:1px solid #d1d5db;border-radius:10px
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}

    .table-wrapper{
      margin-top:12px;
      width:100%;
      overflow-x:auto;
    }

    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    th,td{
      padding:10px 12px;
      border-bottom:1px solid #eee;
      text-align:center;
      word-wrap:break-word;
    }
    th{background:#fafafa}
    td:first-child,th:first-child{text-align:left}

    .muted{color:#6b7280;font-size:12px}
    code{
      background:#f8fafc;border:1px dashed #e5e7eb;
      border-radius:8px;padding:2px 6px
    }
    .empty{
      padding:10px;border:1px dashed #e5e7eb;
      border-radius:10px;background:#fafafa
    }
    .chip{
      display:inline-flex;align-items:center;
      background:#f1f5f9;border:1px solid #e2e8f0;
      padding:6px 12px;border-radius:999px;
      font-size:13px;gap:6px
    }

    /* Responsive */
    @media (max-width:900px){
      body{flex-direction:column}
      .sidebar{
        position:fixed;left:-250px;top:0;
        height:100%;z-index:999;
      }
      .sidebar.show{left:0}
      .toggle-btn{display:block}
      main{padding:70px 16px 20px}
      h1{text-align:center}
      .row{flex-direction:column;align-items:flex-start}
      select,input{width:100%;max-width:100%}
      table{font-size:14px}
      th,td{padding:8px 8px}
    }

    /* Language switcher */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      flex-wrap:wrap;
      gap:16px;
      margin-bottom:18px;
    }
    .topbar-right{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .lang-switcher{
      position:static;
    }
    .lang-switcher select{
      padding:6px 10px;
      border-radius:10px;
      border:1px solid #d1d5db;
      background:#fff;
      font-size:14px;
    }
    .user-chip{
      display:flex;
      align-items:center;
      gap:8px;
      background:#fff;
      border-radius:999px;
      border:1px solid #e5e7eb;
      padding:8px 12px;
      box-shadow:0 6px 18px rgba(15,23,42,.08);
    }
    .user-chip .avatar{
      width:32px;
      height:32px;
      border-radius:50%;
      background:linear-gradient(135deg,#38bdf8,#1d4ed8);
      color:#0f172a;
      font-weight:600;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .user-chip__label{
      margin:0;
      font-size:12px;
    }

    /* ========== OVERRIDES ========== */

    :root{
      --btn-min-h: 44px;
      --btn-pad-x: 16px;
      --btn-pad-y: 10px;
      --btn-radius: 12px;
      --btn-font: 16px;
    }

    h1{ margin: 0 0 16px; line-height: 1.25; }
    h3{ margin: 0 0 10px; line-height: 1.35; }

    input[type="text"],
    input[type="number"],
    select,
    button{
      min-height: var(--btn-min-h);
      padding: var(--btn-pad-y) var(--btn-pad-x);
      border-radius: var(--btn-radius);
      font-size: var(--btn-font);
      line-height: 1.2;
    }

    button,
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      cursor:pointer;
      transition:transform .06s ease,box-shadow .2s ease,background-color .2s ease;
      border:0;
    }

    .primary{ background:#2563eb; color:#fff; }
    .primary:hover{ filter:brightness(1.05); }
    .primary:active{ transform:translateY(1px); }

    .ghost{ background:#f4f4f5; color:#111827; }
    .ghost:hover{ filter:brightness(0.98); }
    .ghost:active{ transform:translateY(1px); }

    .chip{
      min-height: var(--btn-min-h);
      padding: 0 var(--btn-pad-x);
      display:inline-flex;
      align-items:center;
      border-radius:999px;
    }

    .toggle-btn{
      min-height: var(--btn-min-h);
      padding: var(--btn-pad-y) var(--btn-pad-x);
      border-radius: var(--btn-radius);
      font-size: var(--btn-font);
      box-shadow:0 2px 6px rgba(0,0,0,.08);
    }

    button:focus,.toggle-btn:focus,.primary:focus,.ghost:focus,
    input:focus,select:focus{
      outline:3px solid #93c5fd;
      outline-offset:2px;
    }
  </style>
</head>
<body>
  <button class="toggle-btn" onclick="toggleMenu()">☰ เมนู</button>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <h2>Smart Waste</h2>
    <nav class="menu" data-admin-menu data-active="capacity"></nav>
    <div class="sw-logout-slot" data-sw-logout-slot></div>
  </aside>

  <!-- Main -->
  <main>
    <div class="topbar">
      <div>
        <h1 id="mainTitleHeading">ความจุถังขยะ</h1>
        <p class="muted" id="pageHint" style="margin-bottom:8px">
          ค้นหาและดูรายการถังจาก Firestore แบบเรียลไทม์
        </p>
      </div>
      <div class="topbar-right">
        <div class="lang-switcher">
          <select id="langSelect">
            <option value="th">ไทย</option>
            <option value="en">English</option>
            <option value="ms">Bahasa Melayu</option>
          </select>
        </div>
        <div class="user-chip">
          <span class="avatar" id="adminAvatar">A</span>
          <div>
            <p class="muted user-chip__label" id="adminRole">ผู้ดูแลระบบ</p>
            <strong id="adminName">-</strong>
          </div>
        </div>
      </div>
    </div>
    <div class="content">

      <!-- การ์ดตัวกรอง -->
      <div class="card">
        <div class="row">
          <div>
            <label id="labelMode">โหมดตัวกรอง</label>
            <select id="mode">
              <option value="eq">เท่ากับ</option>
              <option value="gte">มากกว่าหรือเท่ากับ</option>
              <option value="lte">น้อยกว่าหรือเท่ากับ</option>
              <option value="between">ระหว่างช่วง (รวมขอบ)</option>
            </select>
          </div>
          <div id="singleBox">
            <label id="labelSingle">ค่า fillLevel (0–100)</label>
            <select id="level"></select>
          </div>
          <div id="rangeBox" style="display:none">
            <label id="labelRange">ช่วงค่า fillLevel (0–100)</label>
            <select id="minLevel"></select> –
            <select id="maxLevel"></select>
          </div>
          <div class="muted" id="collectionHint">
            คอลเลกชัน:
            <code>smartbins / {zone} / bin_data / [BINID]</code> (ข้อมูลหลักถัง)
            + <code>smartbins / {zone} / bin_level / [BINID]</code> (ระดับขยะ)
          </div>
        </div>
        <p id="status" class="muted" style="margin-top:6px"></p>
      </div>

      <!-- ตารางผลลัพธ์ -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div class="chip">
            <span id="count">0</span>
            <span id="itemsLabel">รายการ</span>
          </div>
          <div class="muted" id="sortHint">
            เรียง “ล่าสุดก่อน” โดยอิงเวลาฟิลด์ <code>updatedAt</code> จาก <code>smartbins / {zone} / bin_level / [BINID]</code>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th id="thId">ID (zone/BIN)</th>
                <th id="thZone">เขต</th>
                <th id="thRfid">RFID</th>
                <th id="thFill">fillLevel</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
        <div id="empty" class="empty" style="display:none">
          ไม่พบข้อมูลตามเงื่อนไขที่เลือก
        </div>
      </div>
    </div>
  </main>

  <script>
    /* Firebase Config */
    var firebaseConfig = {
      apiKey: "AIzaSyBNPan4f39QzbwLn5A1SLOLNNhqnf-bZyo",
      authDomain: "smart-waste-a2bf4.firebaseapp.com",
      projectId: "smart-waste-a2bf4",
      storageBucket: "smart-waste-a2bf4.firebasestorage.app",
      messagingSenderId: "522733244689",
      appId: "1:522733244689:web:5c6a0cbe1aaa9e9185fcb0",
      measurementId: "G-B3D2V8DJC1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const modeSel   = document.getElementById('mode'),
          levelSel  = document.getElementById('level'),
          minSel    = document.getElementById('minLevel'),
          maxSel    = document.getElementById('maxLevel'),
          singleBox = document.getElementById('singleBox'),
          rangeBox  = document.getElementById('rangeBox'),
          rows      = document.getElementById('rows'),
          emptyNote = document.getElementById('empty'),
          statusEl  = document.getElementById('status'),
          countEl   = document.getElementById('count'),
          itemsLabel= document.getElementById('itemsLabel');

    /* ===== i18n ===== */
    const translations = {
      th: {
        pageTitle: "Smart Waste - ความจุถังขยะ",
        menuBtn: "☰ เมนู",
        navHome: "หน้าหลัก",
        navRegister: "ลงทะเบียนถังขยะ",
        navaddDriver: "พนักงานขับรถ",
        navCapacity: "ความจุถังขยะ",
        navTruck: "ตำแหน่งรถเก็บขยะ",
        navReport: "รายงานย้อนหลัง",
        mainTitle: "ความจุถังขยะ",
        pageHint: "ค้นหาและดูรายการถังจาก Firestore แบบเรียลไทม์",
        filterMode: "โหมดตัวกรอง",
        modeEq: "เท่ากับ",
        modeGte: "มากกว่าหรือเท่ากับ",
        modeLte: "น้อยกว่าหรือเท่ากับ",
        modeBetween: "ระหว่างช่วง (รวมขอบ)",
        labelSingle: "ค่า fillLevel (0–100)",
        labelRange: "ช่วงค่า fillLevel (0–100)",
        collection: "คอลเลกชัน",
        mainData: "ข้อมูลหลักถัง",
        fillLevelData: "ระดับขยะ",
        items: "รายการ",
        sortHint: "เรียง “ล่าสุดก่อน” โดยอิงเวลาฟิลด์ updatedAt จาก smartbins/{zone}/bin_level/[BINID]",
        tableId: "ID (zone/BIN)",
        tableZone: "เขต",
        tableRfid: "RFID",
        tableFill: "fillLevel",
        emptyResult: "ไม่พบข้อมูลตามเงื่อนไขที่เลือก",
        error: "เกิดข้อผิดพลาด: ",
        loading: "กำลังโหลดข้อมูลถังขยะ...",
        loaded: n => `โหลดข้อมูลถังขยะทั้งหมด ${n} รายการ`,
        roleAdmin: "ผู้ดูแลระบบ",
        roleUser: "ผู้ใช้ทั่วไป",
        logout: "ออกจากระบบ"
      },
      en: {
        pageTitle: "Smart Waste - Bin Capacity",
        menuBtn: "☰ Menu",
        navHome: "Home",
        navRegister: "Register bin",
        navaddDriver: "Driver",
        navCapacity: "Bin Capacity",
        navTruck: "Truck Location",
        navReport: "Historical Report",
        mainTitle: "Bin Capacity",
        pageHint: "Search and view the list of bins from Firestore in real-time.",
        filterMode: "Filter Mode",
        modeEq: "Equal to",
        modeGte: "Greater than or equal to",
        modeLte: "Less than or equal to",
        modeBetween: "Between range (inclusive)",
        labelSingle: "fillLevel value (0–100)",
        labelRange: "fillLevel range (0–100)",
        collection: "Collection",
        mainData: "main bin data",
        fillLevelData: "fill level data",
        items: "items",
        sortHint: "Sorted 'latest first' based on updatedAt from smartbins/{zone}/bin_level/[BINID].",
        tableId: "ID (zone/BIN)",
        tableZone: "Zone",
        tableRfid: "RFID",
        tableFill: "fillLevel",
        emptyResult: "No data found for the selected criteria.",
        error: "An error occurred: ",
        loading: "Loading bin data...",
        loaded: n => `Loaded ${n} bins`,
        roleAdmin: "Administrator",
        roleUser: "User",
        logout: "Logout"
      },
      ms: {
        pageTitle: "Smart Waste - Kapasiti Tong",
        menuBtn: "☰ Menu",
        navHome: "Halaman Utama",
        navRegister: "Daftar Tong",
        navaddDriver: "Pemandu",
        navCapacity: "Kapasiti Tong",
        navTruck: "Lokasi Lori",
        navReport: "Laporan Sejarah",
        mainTitle: "Kapasiti Tong",
        pageHint: "Cari dan lihat senarai tong dari Firestore dalam masa nyata.",
        filterMode: "Mod Penapis",
        modeEq: "Sama dengan",
        modeGte: "Lebih besar daripada atau sama dengan",
        modeLte: "Kurang daripada atau sama dengan",
        modeBetween: "Antara julat (termasuk)",
        labelSingle: "nilai fillLevel (0–100)",
        labelRange: "julat fillLevel (0–100)",
        collection: "Koleksi",
        mainData: "data tong utama",
        fillLevelData: "data tahap isian",
        items: "item",
        sortHint: "Disusun 'terkini dahulu' berdasarkan updatedAt daripada smartbins/{zone}/bin_level/[BINID].",
        tableId: "ID (zon/BIN)",
        tableZone: "Zon",
        tableRfid: "RFID",
        tableFill: "fillLevel",
        emptyResult: "Tiada data ditemui untuk kriteria yang dipilih.",
        error: "Ralat telah berlaku: ",
        loading: "Sedang memuatkan data tong...",
        loaded: n => `Memuatkan ${n} tong`,
        roleAdmin: "Pentadbir",
        roleUser: "Pengguna",
        logout: "Keluar"
      }
    };

    const LangState = window.AdminLang;
    let currentLang = (LangState && typeof LangState.getLang === "function")
      ? LangState.getLang()
      : (localStorage.getItem('sw_lang') || 'th');
    const langSelect = document.getElementById('langSelect');

    function getTranslation(key){
      const t = translations[currentLang];
      return t && t[key] !== undefined ? t[key] : key;
    }
    function setStatus(text){ statusEl.textContent = text || ""; }

    /* เติมค่า 0–100 ให้ดรอปดาว */
    function fill0to100(sel){
      sel.innerHTML='';
      for(let i=0;i<=100;i++){
        const opt=document.createElement('option');
        opt.value=i; opt.textContent=i;
        sel.appendChild(opt);
      }
    }
    [levelSel,minSel,maxSel].forEach(fill0to100);
    levelSel.value=100; minSel.value=80; maxSel.value=100;

    /* ข้อมูลถังทั้งหมด (smartbins + bin_level) */
    let allBins = [];

    // โหลดจาก:
    //  - smartbins/{zone}/bin_data/{BINID}        (ข้อมูลถัง)
    //  - smartbins/{zone}/bin_level/{BINID}       (ระดับขยะ, ฟิลด์ filllevel)
    async function loadAllData(){
      try{
        setStatus(getTranslation('loading'));
        allBins = [];
        const zonesSnap = await db.collection('zones').orderBy('name').get();
        const zoneIds = zonesSnap.docs.map(d => d.id);

        for(const zone of zoneIds){
          // ข้อมูลถังหลัก
          const mainSnap = await db
            .collection('smartbins')
            .doc(zone)
            .collection('bin_data')
            .get();

          // ระดับขยะ
          const levelSnap = await db
            .collection('smartbins')
            .doc(zone)
            .collection('bin_level')
            .get();

          const levelMap = new Map();
          levelSnap.forEach(doc=>{
            levelMap.set(doc.id, doc.data() || {});
          });

          mainSnap.forEach(doc=>{
            const d  = doc.data() || {};
            const id = d.binId || doc.id;
            const lv = levelMap.get(id) || {};
            allBins.push({
              zone,
              binId: id,
              rfid : d.rfid || null,
              // รองรับทั้ง filllevel และ fillLevel เผื่อสะกดไม่เหมือนกัน
              fillLevel: (lv.filllevel ?? lv.fillLevel ?? null),
              levelUpdatedAt: lv.updatedAt ? lv.updatedAt.toDate() : null,
              createdAt: d.createdAt ? d.createdAt.toDate() : null
            });
          });
        }

        setStatus(translations[currentLang].loaded(allBins.length));
        applyFilterAndRender();
      }catch(err){
        console.error(err);
        setStatus(getTranslation('error') + (err.message || err));
      }
    }

    function applyFilterAndRender(){
      if(!allBins.length){
        rows.innerHTML = '';
        countEl.textContent = '0';
        emptyNote.style.display = 'block';
        return;
      }

      const mode = modeSel.value;
      const val  = Number(levelSel.value);
      const minV = Number(minSel.value);
      const maxV = Number(maxSel.value);
      const lo   = Math.min(minV, maxV);
      const hi   = Math.max(minV, maxV);

      let filtered = allBins.filter(b => typeof b.fillLevel === 'number');

      if(mode === 'eq'){
        filtered = filtered.filter(b => b.fillLevel === val);
        setStatus(`fillLevel == ${val}`);
      }else if(mode === 'gte'){
        filtered = filtered.filter(b => b.fillLevel >= val);
        setStatus(`fillLevel >= ${val}`);
      }else if(mode === 'lte'){
        filtered = filtered.filter(b => b.fillLevel <= val);
        setStatus(`fillLevel <= ${val}`);
      }else{
        filtered = filtered.filter(b => b.fillLevel >= lo && b.fillLevel <= hi);
        setStatus(`${lo} <= fillLevel <= ${hi}`);
      }

      // เรียงตามเวลาจาก smartbins/{zone}/bin_level/[BIN] .updatedAt (ล่าสุดก่อน)
      filtered.sort((a,b)=>{
        const ta = (a.levelUpdatedAt ? a.levelUpdatedAt.getTime() : 0);
        const tb = (b.levelUpdatedAt ? b.levelUpdatedAt.getTime() : 0);
        return tb - ta;
      });

      rows.innerHTML = '';
      filtered.forEach(d=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><code>${d.zone}/${d.binId}</code></td>
          <td>${d.zone}</td>
          <td>${d.rfid ?? '—'}</td>
          <td>${d.fillLevel ?? '—'}</td>
        `;
        rows.appendChild(tr);
      });

      countEl.textContent = filtered.length.toString();
      emptyNote.style.display = filtered.length ? 'none' : 'block';
    }

    /* เปลี่ยนภาษา */
    function changeLanguage(lang){
      if(!translations[lang]) return;
      currentLang = lang;
      if (LangState && typeof LangState.setLang === "function") {
        LangState.setLang(lang);
        currentLang = LangState.getLang();
      } else {
        localStorage.setItem('sw_lang', lang);
      }
      langSelect.value = currentLang;

      document.title = getTranslation('pageTitle');
      document.querySelector('.toggle-btn').textContent = getTranslation('menuBtn');

      if(window.AdminNav){
        window.AdminNav.setLanguage(currentLang);
      }

      if (window.AdminUser) {
        window.AdminUser.setLanguage(currentLang);
      }

      document.getElementById('mainTitleHeading').textContent = getTranslation('mainTitle');
      document.getElementById('pageHint').textContent = getTranslation('pageHint');

      document.getElementById('labelMode').textContent   = getTranslation('filterMode');
      document.getElementById('labelSingle').textContent = getTranslation('labelSingle');
      document.getElementById('labelRange').textContent  = getTranslation('labelRange');

      const modeOptions = modeSel.options;
      modeOptions[0].textContent = getTranslation('modeEq');
      modeOptions[1].textContent = getTranslation('modeGte');
      modeOptions[2].textContent = getTranslation('modeLte');
      modeOptions[3].textContent = getTranslation('modeBetween');

      document.getElementById('collectionHint').innerHTML =
        `${getTranslation('collection')}: ` +
        `<code>smartbins / {zone} / bin_data / [BINID]</code> (${getTranslation('mainData')}) + ` +
        `<code>smartbins / {zone} / bin_level / [BINID]</code> (${getTranslation('fillLevelData')})`;

      itemsLabel.textContent = getTranslation('items');
      document.getElementById('sortHint').textContent = getTranslation('sortHint');

      document.getElementById('thId').textContent   = getTranslation('tableId');
      document.getElementById('thZone').textContent = getTranslation('tableZone');
      document.getElementById('thRfid').textContent = getTranslation('tableRfid');
      document.getElementById('thFill').textContent = getTranslation('tableFill');

      emptyNote.textContent = getTranslation('emptyResult');

      applyFilterAndRender();
    }

    langSelect.addEventListener('change', e => changeLanguage(e.target.value));

    if (LangState && typeof LangState.onChange === "function") {
      LangState.onChange(lang => {
        if (lang && lang !== currentLang) {
          currentLang = lang;
          langSelect.value = lang;
          changeLanguage(lang);
        }
      });
    }

    /* เปลี่ยนโหมดตัวกรอง */
    modeSel.addEventListener('change', ()=>{
      const mode = modeSel.value;
      if(mode === 'between'){
        singleBox.style.display = 'none';
        rangeBox.style.display  = '';
      }else{
        singleBox.style.display = '';
        rangeBox.style.display  = 'none';
      }
      applyFilterAndRender();
    });
    [levelSel,minSel,maxSel].forEach(el => el.addEventListener('change', applyFilterAndRender));

    /* ปุ่มเมนูมือถือ + การจัดการ sidebar */
    function toggleMenu(force){
      const sidebar = document.getElementById('sidebar');
      const btn     = document.querySelector('.toggle-btn');
      let isShow;
      if(typeof force === 'boolean'){
        isShow = force;
        sidebar.classList.toggle('show', isShow);
      }else{
        isShow = sidebar.classList.toggle('show');
      }
      if(window.innerWidth <= 900){
        btn.style.display = isShow ? 'none' : 'block';
      }
    }
    window.toggleMenu = toggleMenu;

    document.querySelectorAll('.menu a').forEach(a=>{
      a.addEventListener('click', ()=>{
        if(window.innerWidth <= 900){
          toggleMenu(false);
        }
      });
    });

    window.addEventListener('resize', ()=>{
      const sidebar = document.getElementById('sidebar');
      const btn     = document.querySelector('.toggle-btn');
      if(window.innerWidth > 900){
        sidebar.classList.remove('show');
        btn.style.display = 'none';
      }else{
        btn.style.display = 'block';
      }
    });

    // initial
    changeLanguage(currentLang);
    loadAllData();
  </script>
</body>
</html>
